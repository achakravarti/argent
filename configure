#!/bin/sh


info() {
	echo "[INFO]    $1"
}


warn() {
	echo "[WARNING] $1"
}


error() {
	echo "[ERROR]   $1"
	exit
}


depreq() {
	if [ $SHELL = "/bin/csh" ] ; then
		if which $1 1>/dev/null 2>/dev/null ; then
			info "$1 found..."
		else
			error "$1 not found; install $2 first."
		fi
	else
		if which $1 >&/dev/null ; then
			info "$1 found..."
		else
			error "$1 not found; install $2 first."
		fi
	fi
}


depopt() {
	if [ $SHELL = "/bin/csh" ] ; then
		if which $1 1>/dev/null 2>/dev/null ; then
			info "$1 found..."
		else
			warn "$1 not found; $2 won't be available."
		fi
	else
		if which $1 >&/dev/null ; then
			info "$1 found..."
		else
			warn "$1 not found; $2 won't be available."
		fi
	fi
}


copyright() {
	echo "Argent Library Copyright (C) 2021 Abhishek Chakravarti"
	echo "This program comes with ABSOLUTELY NO WARRANTY; for details see LICENSE."
	echo "This is free software, and you are welcome to redistribute it"
	echo "under certain conditions; see LICENSE for details."
	echo ""
}


check_os() {
	OS=`uname`
	if [ $OS = "Linux" ] ; then
		info "GNU/Linux detected..."
	elif [ $OS = "FreeBSD" ] ; then
		info "FreeBSD detected..."
	else
		error "Unsupported OS; use FreeBSD or a Linux distro."
	fi
}


check_make() {
	depreq make "make"
}


copyright
info "Starting Argent build configuration..."
check_os
check_make
depreq cc "gcc or clang"
depreq psql "postgresql"
depopt ccache "compilation caching"
depopt valgrind "make check"
depopt gcovr "make coverage"

